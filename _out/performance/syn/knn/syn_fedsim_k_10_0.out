Loading data from cache
Done
Calculating noise scale
Adding noise of scale 0.0 to sim_scores
Adding noise of scale 0.0 to sim_scores
Adding noise of scale 0.0 to sim_scores
Filter dataset to top 10
Generating top 10 dataset
Generating top 10 dataset
Generating top 10 dataset
Preparing time (sec): 14
Initializing dataloader
Done
Prepare for training
Start training
SplitNN summary
==========================================================================================
Layer (type:depth-idx)                   Output Shape              Param #
==========================================================================================
SplitNN                                  --                        --
├─MLP: 1                                 --                        --
│    └─ModuleList: 2-1                   --                        --
├─ModuleList: 1-1                        --                        --
│    └─MLP: 2                            --                        --
│    │    └─ModuleList: 3-1              --                        9,650
│    └─MLP: 2                            --                        --
│    │    └─ModuleList: 3-2              --                        9,650
│    └─MLP: 2-2                          [32, 50]                  --
│    └─MLP: 2-3                          [32, 50]                  --
├─MLP: 1-2                               [32, 1]                   --
│    └─ModuleList: 2-1                   --                        --
│    │    └─Linear: 3-3                  [32, 100]                 10,100
│    │    └─Linear: 3-4                  [32, 1]                   101
==========================================================================================
Total params: 29,501
Trainable params: 29,501
Non-trainable params: 0
Total mult-adds (M): 0.94
==========================================================================================
Input size (MB): 0.01
Forward/backward pass size (MB): 0.10
Params size (MB): 0.12
Estimated Total Size (MB): 0.23
==========================================================================================
Similarity model summary
==========================================================================================
Layer (type:depth-idx)                   Output Shape              Param #
==========================================================================================
MLP                                      --                        --
├─ModuleList: 1-1                        --                        --
│    └─Linear: 2-1                       [1, 10]                   20
│    └─Linear: 2-2                       [1, 1]                    11
==========================================================================================
Total params: 31
Trainable params: 31
Non-trainable params: 0
Total mult-adds (M): 0.00
==========================================================================================
Input size (MB): 0.00
Forward/backward pass size (MB): 0.00
Params size (MB): 0.00
Estimated Total Size (MB): 0.00
==========================================================================================
n_classes=2
task=binary_cls
model_name=syn_fedsim_noise_0.2_2022-01-27-11-33-06
sche_threshold=0.0001
sche_patience=10
sche_factor=0.1
use_scheduler=False
num_workers=4
device=cuda:2
test_batch_size=4096
train_batch_size=32
learning_rate=0.001
weight_decay=0.0001
num_epochs=50
model_save_path=ckp/syn_fedsim_noise_0.2_2022-01-27-11-33-06.pth
test_rate=0.2
val_rate=0.1
multiprocess_context=fork
metrics=['accuracy']
metrics_f=[<metric.accuracy.Accuracy object at 0x7f5402219c10>]
hidden_sizes=[100, 100]
model=SplitNN(
  (agg_model): MLP(
    (fc_layers): ModuleList(
      (0): Linear(in_features=100, out_features=100, bias=True)
      (1): Linear(in_features=100, out_features=1, bias=True)
    )
  )
  (local_models): ModuleList(
    (0): MLP(
      (fc_layers): ModuleList(
        (0): Linear(in_features=45, out_features=100, bias=True)
        (1): Linear(in_features=100, out_features=50, bias=True)
      )
    )
    (1): MLP(
      (fc_layers): ModuleList(
        (0): Linear(in_features=45, out_features=100, bias=True)
        (1): Linear(in_features=100, out_features=50, bias=True)
      )
    )
  )
)
writer=<torch.utils.tensorboard.writer.SummaryWriter object at 0x7f5402219c40>
dataset_type=syn
drop_key=True
num_common_features=5
tree_radius=2
tree_leaf_size=1000
knn_k=10
grid_min=-10.0
grid_max=10.0
grid_width=1.5
sim_scaler=StandardScaler()
filter_top_k=10
link_n_jobs=1
psig_p=7
sim_leak_p=1.0
link_threshold_t=0.1
link_epsilon=0.1
n_hash_lsh=20
edit_distance_threshold=1
n_hash_func=10
collision_rate=0.05
qgram_q=2
link_delta=0.1
feature_wise_sim=False
blocking_method=knn
center_threshold=0.5
n_clusters=100
local_hidden_sizes=[[100], [100]]
cut_dims=[50, 50]
agg_hidden_sizes=[100]
scale_analysis=None
mlp_merge=None
use_sim=True
use_conv=False
conv_kernel_v_size=7
conv_n_channels=4
merge_dropout_p=0.8
raw_output_dim=1
log_dir=log/syn_fedsim_noise_0.2_2022-01-27-11-33-06/
update_sim_freq=1
sim_model_save_path=ckp/syn_fedsim_noise_0.2_2022-01-27-11-33-06_sim.pth
merge_model_save_path=ckp/syn_fedsim_noise_0.2_2022-01-27-11-33-06_merge.pth
sim_batch_size=128
sim_weight_decay=0.0001
sim_learning_rate=0.001
merge_model=AvgSumModel()
sim_model=MLP(
  (fc_layers): ModuleList(
    (0): Linear(in_features=1, out_features=10, bias=True)
    (1): Linear(in_features=10, out_features=1, bias=True)
  )
)
sim_hidden_sizes=[10]
merge_hidden_sizes=[400]
data1_shape=(60000, 50)
data2_shape=(60000, 50)
Epoch 1: Loss:            : Train 0.6541, Val 0.6165, Test 0.6169
          Accuracy         : Train 0.5971, Val 0.6595, Test 0.6528
Best:
          Accuracy         : Train 0.5971, Val 0.6595, Test 0.6528
Epoch 2: Loss:            : Train 0.5773, Val 0.5127, Test 0.5181
          Accuracy         : Train 0.6889, Val 0.7457, Test 0.7355
Best:
          Accuracy         : Train 0.6889, Val 0.7457, Test 0.7355
Epoch 3: Loss:            : Train 0.5453, Val 0.4979, Test 0.5030
          Accuracy         : Train 0.7150, Val 0.7455, Test 0.7482
Best:
          Accuracy         : Train 0.6889, Val 0.7457, Test 0.7355
Epoch 4: Loss:            : Train 0.5309, Val 0.4850, Test 0.4932
          Accuracy         : Train 0.7274, Val 0.7618, Test 0.7549
Best:
          Accuracy         : Train 0.7274, Val 0.7618, Test 0.7549
Epoch 5: Loss:            : Train 0.5194, Val 0.4793, Test 0.4886
          Accuracy         : Train 0.7347, Val 0.7627, Test 0.7545
Best:
          Accuracy         : Train 0.7347, Val 0.7627, Test 0.7545
Epoch 6: Loss:            : Train 0.5089, Val 0.4671, Test 0.4806
          Accuracy         : Train 0.7423, Val 0.7733, Test 0.7649
Best:
          Accuracy         : Train 0.7423, Val 0.7733, Test 0.7649
Epoch 7: Loss:            : Train 0.5009, Val 0.4711, Test 0.4806
          Accuracy         : Train 0.7480, Val 0.7698, Test 0.7641
Best:
          Accuracy         : Train 0.7423, Val 0.7733, Test 0.7649
Epoch 8: Loss:            : Train 0.4915, Val 0.4671, Test 0.4797
          Accuracy         : Train 0.7548, Val 0.7733, Test 0.7614
Best:
          Accuracy         : Train 0.7423, Val 0.7733, Test 0.7649
Epoch 9: Loss:            : Train 0.4848, Val 0.4727, Test 0.4841
          Accuracy         : Train 0.7586, Val 0.7712, Test 0.7613
Best:
          Accuracy         : Train 0.7423, Val 0.7733, Test 0.7649
Epoch 10: Loss:            : Train 0.4777, Val 0.4797, Test 0.4947
          Accuracy         : Train 0.7620, Val 0.7670, Test 0.7609
Best:
          Accuracy         : Train 0.7423, Val 0.7733, Test 0.7649
Epoch 11: Loss:            : Train 0.4707, Val 0.4789, Test 0.4873
          Accuracy         : Train 0.7660, Val 0.7685, Test 0.7637
Best:
          Accuracy         : Train 0.7423, Val 0.7733, Test 0.7649
Epoch 12: Loss:            : Train 0.4653, Val 0.4807, Test 0.4915
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 13: Loss:            : Train 0.4575, Val 0.4773, Test 0.4974
          Accuracy         : Train 0.7760, Val 0.7717, Test 0.7582
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 14: Loss:            : Train 0.4510, Val 0.4853, Test 0.5052
          Accuracy         : Train 0.7799, Val 0.7707, Test 0.7552
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 15: Loss:            : Train 0.4452, Val 0.4875, Test 0.5048
          Accuracy         : Train 0.7825, Val 0.7697, Test 0.7567
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 16: Loss:            : Train 0.4393, Val 0.4999, Test 0.5204
          Accuracy         : Train 0.7864, Val 0.7650, Test 0.7537
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 17: Loss:            : Train 0.4326, Val 0.5119, Test 0.5293
          Accuracy         : Train 0.7881, Val 0.7623, Test 0.7539
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 18: Loss:            : Train 0.4285, Val 0.5193, Test 0.5336
          Accuracy         : Train 0.7912, Val 0.7578, Test 0.7523
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 19: Loss:            : Train 0.4228, Val 0.5186, Test 0.5377
          Accuracy         : Train 0.7967, Val 0.7648, Test 0.7502
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 20: Loss:            : Train 0.4170, Val 0.5294, Test 0.5442
          Accuracy         : Train 0.7993, Val 0.7620, Test 0.7507
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 21: Loss:            : Train 0.4127, Val 0.5320, Test 0.5535
          Accuracy         : Train 0.8028, Val 0.7632, Test 0.7488
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 22: Loss:            : Train 0.4082, Val 0.5587, Test 0.5684
          Accuracy         : Train 0.8047, Val 0.7540, Test 0.7471
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 23: Loss:            : Train 0.4035, Val 0.5511, Test 0.5709
          Accuracy         : Train 0.8076, Val 0.7595, Test 0.7458
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 24: Loss:            : Train 0.3991, Val 0.5571, Test 0.5825
          Accuracy         : Train 0.8099, Val 0.7588, Test 0.7438
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 25: Loss:            : Train 0.3948, Val 0.5710, Test 0.6018
          Accuracy         : Train 0.8118, Val 0.7558, Test 0.7413
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 26: Loss:            : Train 0.3920, Val 0.5625, Test 0.5871
          Accuracy         : Train 0.8149, Val 0.7603, Test 0.7421
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 27: Loss:            : Train 0.3878, Val 0.5690, Test 0.5954
          Accuracy         : Train 0.8153, Val 0.7598, Test 0.7459
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 28: Loss:            : Train 0.3846, Val 0.5912, Test 0.6073
          Accuracy         : Train 0.8183, Val 0.7528, Test 0.7403
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 29: Loss:            : Train 0.3834, Val 0.5952, Test 0.6168
          Accuracy         : Train 0.8182, Val 0.7537, Test 0.7388
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 30: Loss:            : Train 0.3795, Val 0.6044, Test 0.6246
          Accuracy         : Train 0.8207, Val 0.7498, Test 0.7389
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 31: Loss:            : Train 0.3773, Val 0.6203, Test 0.6411
          Accuracy         : Train 0.8221, Val 0.7513, Test 0.7431
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 32: Loss:            : Train 0.3760, Val 0.6095, Test 0.6328
          Accuracy         : Train 0.8224, Val 0.7493, Test 0.7417
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 33: Loss:            : Train 0.3723, Val 0.6167, Test 0.6442
          Accuracy         : Train 0.8251, Val 0.7527, Test 0.7387
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 34: Loss:            : Train 0.3701, Val 0.6316, Test 0.6684
          Accuracy         : Train 0.8260, Val 0.7487, Test 0.7344
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 35: Loss:            : Train 0.3685, Val 0.6221, Test 0.6508
          Accuracy         : Train 0.8270, Val 0.7547, Test 0.7391
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 36: Loss:            : Train 0.3684, Val 0.6296, Test 0.6627
          Accuracy         : Train 0.8276, Val 0.7512, Test 0.7363
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 37: Loss:            : Train 0.3652, Val 0.6471, Test 0.6755
          Accuracy         : Train 0.8283, Val 0.7422, Test 0.7314
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 38: Loss:            : Train 0.3623, Val 0.6520, Test 0.7006
          Accuracy         : Train 0.8308, Val 0.7510, Test 0.7347
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 39: Loss:            : Train 0.3629, Val 0.6710, Test 0.7091
          Accuracy         : Train 0.8302, Val 0.7457, Test 0.7325
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 40: Loss:            : Train 0.3598, Val 0.6472, Test 0.6826
          Accuracy         : Train 0.8313, Val 0.7510, Test 0.7382
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 41: Loss:            : Train 0.3576, Val 0.6748, Test 0.7078
          Accuracy         : Train 0.8336, Val 0.7497, Test 0.7337
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 42: Loss:            : Train 0.3575, Val 0.6411, Test 0.6677
          Accuracy         : Train 0.8330, Val 0.7467, Test 0.7321
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 43: Loss:            : Train 0.3547, Val 0.7001, Test 0.7252
          Accuracy         : Train 0.8354, Val 0.7430, Test 0.7287
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 44: Loss:            : Train 0.3531, Val 0.6761, Test 0.6992
          Accuracy         : Train 0.8350, Val 0.7537, Test 0.7361
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 45: Loss:            : Train 0.3530, Val 0.6808, Test 0.6880
          Accuracy         : Train 0.8366, Val 0.7443, Test 0.7374
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 46: Loss:            : Train 0.3503, Val 0.6947, Test 0.7325
          Accuracy         : Train 0.8381, Val 0.7508, Test 0.7319
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 47: Loss:            : Train 0.3490, Val 0.6880, Test 0.7091
          Accuracy         : Train 0.8386, Val 0.7472, Test 0.7338
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 48: Loss:            : Train 0.3484, Val 0.7063, Test 0.7437
          Accuracy         : Train 0.8392, Val 0.7482, Test 0.7314
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 49: Loss:            : Train 0.3463, Val 0.7066, Test 0.7121
          Accuracy         : Train 0.8400, Val 0.7515, Test 0.7371
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Epoch 50: Loss:            : Train 0.3442, Val 0.7336, Test 0.7421
          Accuracy         : Train 0.8424, Val 0.7452, Test 0.7328
Best:
          Accuracy         : Train 0.7711, Val 0.7740, Test 0.7623
Training time (sec): 3187
