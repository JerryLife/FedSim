Splitting data
Splitting...
Matching training set
Constructing tree
Query tree
Calculate sim_scores
Saving raw sim scores
Done scaling
Got 42000 samples in A
Setting index
Linking records
Step 1 done.
Finished Linking, got 4200000 samples
Filling null values
extracting data to numpy arrays
Matching validation set
Constructing tree
Query tree
Calculate sim_scores
Done scaling
Got 6000 samples in A
Setting index
Linking records
Step 1 done.
Finished Linking, got 600000 samples
Filling null values
extracting data to numpy arrays
Matching test set
Constructing tree
Query tree
Calculate sim_scores
Done scaling
Got 12000 samples in A
Setting index
Linking records
Step 1 done.
Finished Linking, got 1200000 samples
Filling null values
extracting data to numpy arrays
Replace NaN with mean value
Train done.
Validation done.
Test done.
Replace NaN with mean value
Train done.
Validation done.
Test done.
Grouping data
Done
Checking if B is sorted by similarity: False
Sorting data
Done
Retrieve data
Done
Grouping data
Done
Checking if B is sorted by similarity: False
Sorting data
Done
Retrieve data
Done
Grouping data
Done
Checking if B is sorted by similarity: False
Sorting data
Done
Retrieve data
Done
Saving data to cache
Saved
Calculating noise scale
Adding noise of scale 0.0 to sim_scores
Adding noise of scale 0.0 to sim_scores
Adding noise of scale 0.0 to sim_scores
Preparing time (sec): 98
Initializing dataloader
Done
Prepare for training
Start training
SplitNN summary
==========================================================================================
Layer (type:depth-idx)                   Output Shape              Param #
==========================================================================================
SplitNN                                  --                        --
├─MLP: 1                                 --                        --
│    └─ModuleList: 2-1                   --                        --
├─ModuleList: 1-1                        --                        --
│    └─MLP: 2                            --                        --
│    │    └─ModuleList: 3-1              --                        9,650
│    └─MLP: 2                            --                        --
│    │    └─ModuleList: 3-2              --                        9,650
│    └─MLP: 2-2                          [32, 50]                  --
│    └─MLP: 2-3                          [32, 50]                  --
├─MLP: 1-2                               [32, 1]                   --
│    └─ModuleList: 2-1                   --                        --
│    │    └─Linear: 3-3                  [32, 100]                 10,100
│    │    └─Linear: 3-4                  [32, 1]                   101
==========================================================================================
Total params: 29,501
Trainable params: 29,501
Non-trainable params: 0
Total mult-adds (M): 0.94
==========================================================================================
Input size (MB): 0.01
Forward/backward pass size (MB): 0.10
Params size (MB): 0.12
Estimated Total Size (MB): 0.23
==========================================================================================
Similarity model summary
==========================================================================================
Layer (type:depth-idx)                   Output Shape              Param #
==========================================================================================
MLP                                      --                        --
├─ModuleList: 1-1                        --                        --
│    └─Linear: 2-1                       [1, 10]                   20
│    └─Linear: 2-2                       [1, 10]                   110
│    └─Linear: 2-3                       [1, 1]                    11
==========================================================================================
Total params: 141
Trainable params: 141
Non-trainable params: 0
Total mult-adds (M): 0.00
==========================================================================================
Input size (MB): 0.00
Forward/backward pass size (MB): 0.00
Params size (MB): 0.00
Estimated Total Size (MB): 0.00
==========================================================================================
n_classes=2
task=binary_cls
model_name=syn_fedsim_noise_0.1_2022-01-30-01-37-06
sche_threshold=0.0001
sche_patience=10
sche_factor=0.1
use_scheduler=False
num_workers=4
device=cuda:0
test_batch_size=4096
train_batch_size=32
learning_rate=0.001
weight_decay=0.0001
num_epochs=50
model_save_path=ckp/syn_fedsim_noise_0.1_2022-01-30-01-37-06.pth
test_rate=0.2
val_rate=0.1
multiprocess_context=fork
metrics=['accuracy']
metrics_f=[<metric.accuracy.Accuracy object at 0x7f1dc87e0af0>]
hidden_sizes=[100, 100]
model=SplitNN(
  (agg_model): MLP(
    (fc_layers): ModuleList(
      (0): Linear(in_features=100, out_features=100, bias=True)
      (1): Linear(in_features=100, out_features=1, bias=True)
    )
  )
  (local_models): ModuleList(
    (0): MLP(
      (fc_layers): ModuleList(
        (0): Linear(in_features=45, out_features=100, bias=True)
        (1): Linear(in_features=100, out_features=50, bias=True)
      )
    )
    (1): MLP(
      (fc_layers): ModuleList(
        (0): Linear(in_features=45, out_features=100, bias=True)
        (1): Linear(in_features=100, out_features=50, bias=True)
      )
    )
  )
)
writer=<torch.utils.tensorboard.writer.SummaryWriter object at 0x7f1dc87e0b50>
dataset_type=syn
drop_key=True
num_common_features=5
tree_radius=2
tree_leaf_size=1000
knn_k=100
grid_min=-10.0
grid_max=10.0
grid_width=1.5
sim_scaler=StandardScaler()
filter_top_k=None
link_n_jobs=1
psig_p=7
sim_leak_p=1.0
link_threshold_t=0.1
link_epsilon=0.1
n_hash_lsh=20
edit_distance_threshold=1
n_hash_func=10
collision_rate=0.05
qgram_q=2
link_delta=0.1
feature_wise_sim=False
blocking_method=knn
center_threshold=0.5
n_clusters=100
local_hidden_sizes=[[100], [100]]
cut_dims=[50, 50]
agg_hidden_sizes=[100]
scale_analysis=None
mlp_merge=None
use_sim=True
use_conv=False
conv_kernel_v_size=7
conv_n_channels=4
merge_dropout_p=0.8
raw_output_dim=1
log_dir=log/syn_fedsim_noise_0.1_2022-01-30-01-37-06/
update_sim_freq=1
sim_model_save_path=ckp/syn_fedsim_noise_0.1_2022-01-30-01-37-06_sim.pth
merge_model_save_path=ckp/syn_fedsim_noise_0.1_2022-01-30-01-37-06_merge.pth
sim_batch_size=128
sim_weight_decay=0.0001
sim_learning_rate=0.001
merge_model=AvgSumModel()
sim_model=MLP(
  (fc_layers): ModuleList(
    (0): Linear(in_features=1, out_features=10, bias=True)
    (1): Linear(in_features=10, out_features=10, bias=True)
    (2): Linear(in_features=10, out_features=1, bias=True)
  )
)
sim_hidden_sizes=[10, 10]
merge_hidden_sizes=[400]
data1_shape=(60000, 50)
data2_shape=(60000, 50)
Epoch 1: Loss:            : Train 0.6557, Val 0.6117, Test 0.6147
          Accuracy         : Train 0.5946, Val 0.6628, Test 0.6517
Best:
          Accuracy         : Train 0.5946, Val 0.6628, Test 0.6517
Epoch 2: Loss:            : Train 0.4586, Val 0.3497, Test 0.3502
          Accuracy         : Train 0.7765, Val 0.8425, Test 0.8434
Best:
          Accuracy         : Train 0.7765, Val 0.8425, Test 0.8434
Epoch 3: Loss:            : Train 0.3568, Val 0.3122, Test 0.3170
          Accuracy         : Train 0.8405, Val 0.8653, Test 0.8621
Best:
          Accuracy         : Train 0.8405, Val 0.8653, Test 0.8621
Epoch 4: Loss:            : Train 0.3265, Val 0.2830, Test 0.2859
          Accuracy         : Train 0.8578, Val 0.8777, Test 0.8768
Best:
          Accuracy         : Train 0.8578, Val 0.8777, Test 0.8768
Epoch 5: Loss:            : Train 0.3000, Val 0.2672, Test 0.2784
          Accuracy         : Train 0.8699, Val 0.8880, Test 0.8816
Best:
          Accuracy         : Train 0.8699, Val 0.8880, Test 0.8816
Epoch 6: Loss:            : Train 0.2825, Val 0.2661, Test 0.2760
          Accuracy         : Train 0.8804, Val 0.8818, Test 0.8854
Best:
          Accuracy         : Train 0.8699, Val 0.8880, Test 0.8816
Epoch 7: Loss:            : Train 0.2685, Val 0.2576, Test 0.2697
          Accuracy         : Train 0.8882, Val 0.8935, Test 0.8873
Best:
          Accuracy         : Train 0.8882, Val 0.8935, Test 0.8873
Epoch 8: Loss:            : Train 0.2568, Val 0.2578, Test 0.2653
          Accuracy         : Train 0.8935, Val 0.8892, Test 0.8918
Best:
          Accuracy         : Train 0.8882, Val 0.8935, Test 0.8873
Epoch 9: Loss:            : Train 0.2471, Val 0.2511, Test 0.2616
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 10: Loss:            : Train 0.2373, Val 0.2651, Test 0.2710
          Accuracy         : Train 0.9037, Val 0.8917, Test 0.8918
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 11: Loss:            : Train 0.2277, Val 0.2594, Test 0.2686
          Accuracy         : Train 0.9086, Val 0.8943, Test 0.8942
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 12: Loss:            : Train 0.2195, Val 0.2731, Test 0.2915
          Accuracy         : Train 0.9117, Val 0.8923, Test 0.8866
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 13: Loss:            : Train 0.2114, Val 0.2660, Test 0.2754
          Accuracy         : Train 0.9150, Val 0.8933, Test 0.8922
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 14: Loss:            : Train 0.2039, Val 0.2777, Test 0.2893
          Accuracy         : Train 0.9189, Val 0.8900, Test 0.8898
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 15: Loss:            : Train 0.1972, Val 0.2814, Test 0.2873
          Accuracy         : Train 0.9223, Val 0.8928, Test 0.8946
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 16: Loss:            : Train 0.1892, Val 0.2977, Test 0.3066
          Accuracy         : Train 0.9249, Val 0.8920, Test 0.8907
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 17: Loss:            : Train 0.1832, Val 0.2795, Test 0.2977
          Accuracy         : Train 0.9279, Val 0.8962, Test 0.8915
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 18: Loss:            : Train 0.1766, Val 0.3016, Test 0.3108
          Accuracy         : Train 0.9309, Val 0.8920, Test 0.8902
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 19: Loss:            : Train 0.1699, Val 0.3086, Test 0.3202
          Accuracy         : Train 0.9329, Val 0.8963, Test 0.8923
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 20: Loss:            : Train 0.1644, Val 0.3396, Test 0.3491
          Accuracy         : Train 0.9350, Val 0.8898, Test 0.8828
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 21: Loss:            : Train 0.1600, Val 0.3227, Test 0.3370
          Accuracy         : Train 0.9379, Val 0.8925, Test 0.8906
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 22: Loss:            : Train 0.1544, Val 0.3201, Test 0.3347
          Accuracy         : Train 0.9396, Val 0.8947, Test 0.8918
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 23: Loss:            : Train 0.1499, Val 0.3502, Test 0.3670
          Accuracy         : Train 0.9408, Val 0.8968, Test 0.8882
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 24: Loss:            : Train 0.1452, Val 0.3727, Test 0.3724
          Accuracy         : Train 0.9442, Val 0.8930, Test 0.8888
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 25: Loss:            : Train 0.1411, Val 0.3656, Test 0.3804
          Accuracy         : Train 0.9441, Val 0.8918, Test 0.8872
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 26: Loss:            : Train 0.1380, Val 0.3666, Test 0.3813
          Accuracy         : Train 0.9460, Val 0.8968, Test 0.8944
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 27: Loss:            : Train 0.1357, Val 0.3812, Test 0.3995
          Accuracy         : Train 0.9470, Val 0.8943, Test 0.8883
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 28: Loss:            : Train 0.1335, Val 0.3778, Test 0.3960
          Accuracy         : Train 0.9482, Val 0.8917, Test 0.8895
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 29: Loss:            : Train 0.1315, Val 0.3967, Test 0.4177
          Accuracy         : Train 0.9493, Val 0.8963, Test 0.8880
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 30: Loss:            : Train 0.1268, Val 0.4149, Test 0.4296
          Accuracy         : Train 0.9513, Val 0.8932, Test 0.8892
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 31: Loss:            : Train 0.1269, Val 0.3986, Test 0.4174
          Accuracy         : Train 0.9506, Val 0.8928, Test 0.8931
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 32: Loss:            : Train 0.1258, Val 0.4293, Test 0.4395
          Accuracy         : Train 0.9522, Val 0.8902, Test 0.8902
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 33: Loss:            : Train 0.1226, Val 0.4591, Test 0.4662
          Accuracy         : Train 0.9525, Val 0.8878, Test 0.8888
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 34: Loss:            : Train 0.1234, Val 0.4462, Test 0.4426
          Accuracy         : Train 0.9524, Val 0.8938, Test 0.8927
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 35: Loss:            : Train 0.1197, Val 0.4430, Test 0.4533
          Accuracy         : Train 0.9542, Val 0.8912, Test 0.8922
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 36: Loss:            : Train 0.1216, Val 0.4565, Test 0.4622
          Accuracy         : Train 0.9537, Val 0.8943, Test 0.8910
Best:
          Accuracy         : Train 0.8991, Val 0.8973, Test 0.8931
Epoch 37: Loss:            : Train 0.1185, Val 0.4437, Test 0.4660
          Accuracy         : Train 0.9547, Val 0.8993, Test 0.8888
Best:
          Accuracy         : Train 0.9547, Val 0.8993, Test 0.8888
Epoch 38: Loss:            : Train 0.1188, Val 0.4775, Test 0.4787
          Accuracy         : Train 0.9543, Val 0.8905, Test 0.8893
Best:
          Accuracy         : Train 0.9547, Val 0.8993, Test 0.8888
Epoch 39: Loss:            : Train 0.1177, Val 0.5160, Test 0.5228
          Accuracy         : Train 0.9549, Val 0.8885, Test 0.8856
Best:
          Accuracy         : Train 0.9547, Val 0.8993, Test 0.8888
Epoch 40: Loss:            : Train 0.1191, Val 0.4785, Test 0.4687
          Accuracy         : Train 0.9546, Val 0.8942, Test 0.8923
Best:
          Accuracy         : Train 0.9547, Val 0.8993, Test 0.8888
Epoch 41: Loss:            : Train 0.1159, Val 0.4882, Test 0.4971
          Accuracy         : Train 0.9559, Val 0.8962, Test 0.8909
Best:
          Accuracy         : Train 0.9547, Val 0.8993, Test 0.8888
Epoch 42: Loss:            : Train 0.1160, Val 0.4619, Test 0.4722
          Accuracy         : Train 0.9565, Val 0.8923, Test 0.8873
Best:
          Accuracy         : Train 0.9547, Val 0.8993, Test 0.8888
Epoch 43: Loss:            : Train 0.1137, Val 0.4498, Test 0.4664
          Accuracy         : Train 0.9569, Val 0.8967, Test 0.8928
Best:
          Accuracy         : Train 0.9547, Val 0.8993, Test 0.8888
Epoch 44: Loss:            : Train 0.1155, Val 0.4688, Test 0.4843
          Accuracy         : Train 0.9566, Val 0.9012, Test 0.8899
Best:
          Accuracy         : Train 0.9566, Val 0.9012, Test 0.8899
Epoch 45: Loss:            : Train 0.1126, Val 0.4840, Test 0.5171
          Accuracy         : Train 0.9571, Val 0.8973, Test 0.8884
Best:
          Accuracy         : Train 0.9566, Val 0.9012, Test 0.8899
Epoch 46: Loss:            : Train 0.1145, Val 0.4765, Test 0.4930
          Accuracy         : Train 0.9570, Val 0.8983, Test 0.8922
Best:
          Accuracy         : Train 0.9566, Val 0.9012, Test 0.8899
Epoch 47: Loss:            : Train 0.1125, Val 0.5112, Test 0.4987
          Accuracy         : Train 0.9579, Val 0.8933, Test 0.8919
Best:
          Accuracy         : Train 0.9566, Val 0.9012, Test 0.8899
Epoch 48: Loss:            : Train 0.1125, Val 0.5076, Test 0.5055
          Accuracy         : Train 0.9584, Val 0.8968, Test 0.8929
Best:
          Accuracy         : Train 0.9566, Val 0.9012, Test 0.8899
Epoch 49: Loss:            : Train 0.1112, Val 0.5054, Test 0.5293
          Accuracy         : Train 0.9585, Val 0.8978, Test 0.8897
Best:
          Accuracy         : Train 0.9566, Val 0.9012, Test 0.8899
Epoch 50: Loss:            : Train 0.1128, Val 0.5036, Test 0.5201
          Accuracy         : Train 0.9578, Val 0.8948, Test 0.8905
Best:
          Accuracy         : Train 0.9566, Val 0.9012, Test 0.8899
Training time (sec): 1723
