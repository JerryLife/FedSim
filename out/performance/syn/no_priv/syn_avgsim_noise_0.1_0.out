Splitting data
Splitting...
Matching training set
Constructing tree
Query tree
Calculate sim_scores
Saving raw sim scores
Done scaling
Got 42000 samples in A
Setting index
Linking records
Step 1 done.
Finished Linking, got 4200000 samples
Filling null values
extracting data to numpy arrays
Matching validation set
Constructing tree
Query tree
Calculate sim_scores
Done scaling
Got 6000 samples in A
Setting index
Linking records
Step 1 done.
Finished Linking, got 600000 samples
Filling null values
extracting data to numpy arrays
Matching test set
Constructing tree
Query tree
Calculate sim_scores
Done scaling
Got 12000 samples in A
Setting index
Linking records
Step 1 done.
Finished Linking, got 1200000 samples
Filling null values
extracting data to numpy arrays
Replace NaN with mean value
Train done.
Validation done.
Test done.
Replace NaN with mean value
Train done.
Validation done.
Test done.
Grouping data
Done
Checking if B is sorted by similarity: False
Sorting data
Done
Retrieve data
Done
Grouping data
Done
Checking if B is sorted by similarity: False
Sorting data
Done
Retrieve data
Done
Grouping data
Done
Checking if B is sorted by similarity: False
Sorting data
Done
Retrieve data
Done
Saving data to cache
Saved
Calculating noise scale
Adding noise of scale 0.0 to sim_scores
Adding noise of scale 0.0 to sim_scores
Adding noise of scale 0.0 to sim_scores
Preparing time (sec): 98
Initializing dataloader
Done
Prepare for training
Start training
================================================================================
                                    Kernel Shape Output Shape  Params  \
Layer                                                                   
0_local_models.0.fc_layers.Linear_0    [45, 100]    [32, 100]    4600   
1_local_models.0.fc_layers.Linear_1    [100, 50]     [32, 50]    5050   
2_local_models.1.fc_layers.Linear_0    [45, 100]    [32, 100]    4600   
3_local_models.1.fc_layers.Linear_1    [100, 50]     [32, 50]    5050   
4_agg_model.fc_layers.Linear_0        [100, 100]    [32, 100]   10100   
5_agg_model.fc_layers.Linear_1          [100, 1]      [32, 1]     101   

                                     Mult-Adds  
Layer                                           
0_local_models.0.fc_layers.Linear_0       4500  
1_local_models.0.fc_layers.Linear_1       5000  
2_local_models.1.fc_layers.Linear_0       4500  
3_local_models.1.fc_layers.Linear_1       5000  
4_agg_model.fc_layers.Linear_0           10000  
5_agg_model.fc_layers.Linear_1             100  
--------------------------------------------------------------------------------
                      Totals
Total params           29501
Trainable params       29501
Non-trainable params       0
Mult-Adds              29100
================================================================================
n_classes=2
task=binary_cls
model_name=syn_avgsim_noise_0.1_2022-01-30-01-37-07
sche_threshold=0.0001
sche_patience=10
sche_factor=0.1
use_scheduler=False
num_workers=4
device=cuda:0
test_batch_size=4096
train_batch_size=32
learning_rate=0.001
weight_decay=0.0001
num_epochs=50
model_save_path=ckp/syn_avgsim_noise_0.1_2022-01-30-01-37-07.pth
test_rate=0.2
val_rate=0.1
multiprocess_context=fork
metrics=['accuracy']
metrics_f=[<metric.accuracy.Accuracy object at 0x7f36c3f09e50>]
hidden_sizes=[100, 100]
model=SplitNN(
  (agg_model): MLP(
    (fc_layers): ModuleList(
      (0): Linear(in_features=100, out_features=100, bias=True)
      (1): Linear(in_features=100, out_features=1, bias=True)
    )
  )
  (local_models): ModuleList(
    (0): MLP(
      (fc_layers): ModuleList(
        (0): Linear(in_features=45, out_features=100, bias=True)
        (1): Linear(in_features=100, out_features=50, bias=True)
      )
    )
    (1): MLP(
      (fc_layers): ModuleList(
        (0): Linear(in_features=45, out_features=100, bias=True)
        (1): Linear(in_features=100, out_features=50, bias=True)
      )
    )
  )
)
writer=<torch.utils.tensorboard.writer.SummaryWriter object at 0x7f36c3f09e80>
dataset_type=syn
drop_key=True
num_common_features=5
tree_radius=2
tree_leaf_size=1000
knn_k=100
grid_min=-10.0
grid_max=10.0
grid_width=1.5
sim_scaler=StandardScaler()
filter_top_k=None
link_n_jobs=1
psig_p=7
sim_leak_p=1.0
link_threshold_t=0.1
link_epsilon=0.1
n_hash_lsh=20
edit_distance_threshold=1
n_hash_func=10
collision_rate=0.05
qgram_q=2
link_delta=0.1
feature_wise_sim=False
blocking_method=knn
center_threshold=0.5
n_clusters=100
local_hidden_sizes=[[100], [100]]
cut_dims=[50, 50]
agg_hidden_sizes=[100]
scale_analysis=None
log_dir=log/syn_avgsim_noise_0.1_2022-01-30-01-37-07/
update_sim_freq=1
sim_model_save_path=ckp/syn_avgsim_noise_0.1_2022-01-30-01-37-07_sim.pth
sim_batch_size=4096
sim_weight_decay=0.0001
sim_learning_rate=0.001
merge_mode=avg
sim_model=None
sim_hidden_sizes=[10]
data1_shape=(60000, 50)
data2_shape=(60000, 50)
Epoch 1: Loss:            : Train 0.6552, Val 0.6376, Test 0.6359
          Accuracy         : Train 0.6004, Val 0.6255, Test 0.6184
Best:
          Accuracy         : Train 0.6004, Val 0.6255, Test 0.6184
Epoch 2: Loss:            : Train 0.6278, Val 0.6296, Test 0.6280
          Accuracy         : Train 0.6384, Val 0.6298, Test 0.6352
Best:
          Accuracy         : Train 0.6384, Val 0.6298, Test 0.6352
Epoch 3: Loss:            : Train 0.6198, Val 0.6282, Test 0.6245
          Accuracy         : Train 0.6495, Val 0.6358, Test 0.6379
Best:
          Accuracy         : Train 0.6495, Val 0.6358, Test 0.6379
Epoch 4: Loss:            : Train 0.6140, Val 0.6259, Test 0.6244
          Accuracy         : Train 0.6556, Val 0.6317, Test 0.6391
Best:
          Accuracy         : Train 0.6495, Val 0.6358, Test 0.6379
Epoch 5: Loss:            : Train 0.6080, Val 0.6217, Test 0.6187
          Accuracy         : Train 0.6611, Val 0.6415, Test 0.6475
Best:
          Accuracy         : Train 0.6611, Val 0.6415, Test 0.6475
Epoch 6: Loss:            : Train 0.6033, Val 0.6200, Test 0.6180
          Accuracy         : Train 0.6664, Val 0.6443, Test 0.6432
Best:
          Accuracy         : Train 0.6664, Val 0.6443, Test 0.6432
Epoch 7: Loss:            : Train 0.5963, Val 0.6235, Test 0.6204
          Accuracy         : Train 0.6722, Val 0.6432, Test 0.6472
Best:
          Accuracy         : Train 0.6664, Val 0.6443, Test 0.6432
Epoch 8: Loss:            : Train 0.5910, Val 0.6191, Test 0.6172
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 9: Loss:            : Train 0.5858, Val 0.6239, Test 0.6218
          Accuracy         : Train 0.6815, Val 0.6417, Test 0.6464
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 10: Loss:            : Train 0.5808, Val 0.6227, Test 0.6170
          Accuracy         : Train 0.6845, Val 0.6435, Test 0.6489
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 11: Loss:            : Train 0.5766, Val 0.6253, Test 0.6202
          Accuracy         : Train 0.6905, Val 0.6428, Test 0.6453
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 12: Loss:            : Train 0.5721, Val 0.6275, Test 0.6228
          Accuracy         : Train 0.6929, Val 0.6403, Test 0.6494
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 13: Loss:            : Train 0.5683, Val 0.6274, Test 0.6209
          Accuracy         : Train 0.6967, Val 0.6438, Test 0.6445
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 14: Loss:            : Train 0.5654, Val 0.6322, Test 0.6297
          Accuracy         : Train 0.7003, Val 0.6403, Test 0.6418
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 15: Loss:            : Train 0.5614, Val 0.6356, Test 0.6248
          Accuracy         : Train 0.7039, Val 0.6385, Test 0.6446
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 16: Loss:            : Train 0.5580, Val 0.6345, Test 0.6282
          Accuracy         : Train 0.7068, Val 0.6412, Test 0.6403
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 17: Loss:            : Train 0.5560, Val 0.6329, Test 0.6287
          Accuracy         : Train 0.7061, Val 0.6407, Test 0.6408
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 18: Loss:            : Train 0.5519, Val 0.6466, Test 0.6433
          Accuracy         : Train 0.7083, Val 0.6332, Test 0.6392
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 19: Loss:            : Train 0.5498, Val 0.6451, Test 0.6370
          Accuracy         : Train 0.7121, Val 0.6332, Test 0.6398
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 20: Loss:            : Train 0.5463, Val 0.6474, Test 0.6425
          Accuracy         : Train 0.7152, Val 0.6388, Test 0.6377
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 21: Loss:            : Train 0.5439, Val 0.6430, Test 0.6357
          Accuracy         : Train 0.7167, Val 0.6343, Test 0.6370
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 22: Loss:            : Train 0.5410, Val 0.6429, Test 0.6342
          Accuracy         : Train 0.7187, Val 0.6297, Test 0.6386
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 23: Loss:            : Train 0.5382, Val 0.6477, Test 0.6379
          Accuracy         : Train 0.7210, Val 0.6325, Test 0.6408
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 24: Loss:            : Train 0.5362, Val 0.6601, Test 0.6512
          Accuracy         : Train 0.7206, Val 0.6330, Test 0.6332
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 25: Loss:            : Train 0.5340, Val 0.6592, Test 0.6498
          Accuracy         : Train 0.7252, Val 0.6325, Test 0.6321
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 26: Loss:            : Train 0.5315, Val 0.6682, Test 0.6603
          Accuracy         : Train 0.7259, Val 0.6278, Test 0.6282
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 27: Loss:            : Train 0.5293, Val 0.6631, Test 0.6554
          Accuracy         : Train 0.7305, Val 0.6313, Test 0.6314
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 28: Loss:            : Train 0.5273, Val 0.6623, Test 0.6545
          Accuracy         : Train 0.7291, Val 0.6287, Test 0.6295
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 29: Loss:            : Train 0.5251, Val 0.6575, Test 0.6487
          Accuracy         : Train 0.7287, Val 0.6323, Test 0.6374
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 30: Loss:            : Train 0.5225, Val 0.6699, Test 0.6644
          Accuracy         : Train 0.7308, Val 0.6283, Test 0.6302
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 31: Loss:            : Train 0.5206, Val 0.6752, Test 0.6623
          Accuracy         : Train 0.7349, Val 0.6238, Test 0.6356
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 32: Loss:            : Train 0.5190, Val 0.6707, Test 0.6597
          Accuracy         : Train 0.7378, Val 0.6250, Test 0.6288
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 33: Loss:            : Train 0.5177, Val 0.6777, Test 0.6684
          Accuracy         : Train 0.7384, Val 0.6225, Test 0.6268
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 34: Loss:            : Train 0.5146, Val 0.6810, Test 0.6745
          Accuracy         : Train 0.7392, Val 0.6263, Test 0.6288
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 35: Loss:            : Train 0.5136, Val 0.6877, Test 0.6776
          Accuracy         : Train 0.7387, Val 0.6215, Test 0.6317
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 36: Loss:            : Train 0.5116, Val 0.6886, Test 0.6781
          Accuracy         : Train 0.7406, Val 0.6207, Test 0.6302
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 37: Loss:            : Train 0.5099, Val 0.6802, Test 0.6730
          Accuracy         : Train 0.7416, Val 0.6222, Test 0.6317
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 38: Loss:            : Train 0.5080, Val 0.6942, Test 0.6888
          Accuracy         : Train 0.7439, Val 0.6247, Test 0.6342
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 39: Loss:            : Train 0.5054, Val 0.6803, Test 0.6727
          Accuracy         : Train 0.7459, Val 0.6282, Test 0.6293
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 40: Loss:            : Train 0.5039, Val 0.6891, Test 0.6839
          Accuracy         : Train 0.7457, Val 0.6218, Test 0.6277
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 41: Loss:            : Train 0.5013, Val 0.6800, Test 0.6767
          Accuracy         : Train 0.7477, Val 0.6290, Test 0.6308
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 42: Loss:            : Train 0.4999, Val 0.6959, Test 0.6977
          Accuracy         : Train 0.7493, Val 0.6202, Test 0.6267
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 43: Loss:            : Train 0.4980, Val 0.6942, Test 0.6837
          Accuracy         : Train 0.7501, Val 0.6197, Test 0.6267
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 44: Loss:            : Train 0.4954, Val 0.7046, Test 0.7152
          Accuracy         : Train 0.7527, Val 0.6118, Test 0.6218
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 45: Loss:            : Train 0.4935, Val 0.7163, Test 0.7150
          Accuracy         : Train 0.7525, Val 0.6272, Test 0.6299
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 46: Loss:            : Train 0.4914, Val 0.7100, Test 0.7179
          Accuracy         : Train 0.7560, Val 0.6188, Test 0.6238
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 47: Loss:            : Train 0.4886, Val 0.7041, Test 0.7009
          Accuracy         : Train 0.7557, Val 0.6125, Test 0.6242
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 48: Loss:            : Train 0.4876, Val 0.7225, Test 0.7160
          Accuracy         : Train 0.7595, Val 0.6213, Test 0.6272
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 49: Loss:            : Train 0.4842, Val 0.7153, Test 0.7114
          Accuracy         : Train 0.7601, Val 0.6195, Test 0.6269
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Epoch 50: Loss:            : Train 0.4822, Val 0.7150, Test 0.7092
          Accuracy         : Train 0.7606, Val 0.6235, Test 0.6292
Best:
          Accuracy         : Train 0.6762, Val 0.6455, Test 0.6462
Training time (sec): 1491
