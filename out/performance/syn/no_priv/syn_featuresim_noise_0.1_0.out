Splitting data
Splitting...
Matching training set
Constructing tree
Query tree
Calculate sim_scores
Saving raw sim scores
Done scaling
Got 42000 samples in A
Setting index
Linking records
Step 1 done.
Finished Linking, got 4200000 samples
Filling null values
extracting data to numpy arrays
Matching validation set
Constructing tree
Query tree
Calculate sim_scores
Done scaling
Got 6000 samples in A
Setting index
Linking records
Step 1 done.
Finished Linking, got 600000 samples
Filling null values
extracting data to numpy arrays
Matching test set
Constructing tree
Query tree
Calculate sim_scores
Done scaling
Got 12000 samples in A
Setting index
Linking records
Step 1 done.
Finished Linking, got 1200000 samples
Filling null values
extracting data to numpy arrays
Replace NaN with mean value
Train done.
Validation done.
Test done.
Replace NaN with mean value
Train done.
Validation done.
Test done.
Grouping data
Done
Checking if B is sorted by similarity: False
Sorting data
Done
Retrieve data
Done
Grouping data
Done
Checking if B is sorted by similarity: False
Sorting data
Done
Retrieve data
Done
Grouping data
Done
Checking if B is sorted by similarity: False
Sorting data
Done
Retrieve data
Done
Saving data to cache
Saved
Calculating noise scale
Adding noise of scale 0.0 to sim_scores
Adding noise of scale 0.0 to sim_scores
Adding noise of scale 0.0 to sim_scores
Preparing time (sec): 89
Initializing dataloader
Done
Prepare for training
Start training
================================================================================
                                    Kernel Shape Output Shape  Params  \
Layer                                                                   
0_local_models.0.fc_layers.Linear_0    [46, 100]    [32, 100]    4700   
1_local_models.0.fc_layers.Linear_1    [100, 50]     [32, 50]    5050   
2_local_models.1.fc_layers.Linear_0    [45, 100]    [32, 100]    4600   
3_local_models.1.fc_layers.Linear_1    [100, 50]     [32, 50]    5050   
4_agg_model.fc_layers.Linear_0        [100, 100]    [32, 100]   10100   
5_agg_model.fc_layers.Linear_1          [100, 1]      [32, 1]     101   

                                     Mult-Adds  
Layer                                           
0_local_models.0.fc_layers.Linear_0       4600  
1_local_models.0.fc_layers.Linear_1       5000  
2_local_models.1.fc_layers.Linear_0       4500  
3_local_models.1.fc_layers.Linear_1       5000  
4_agg_model.fc_layers.Linear_0           10000  
5_agg_model.fc_layers.Linear_1             100  
--------------------------------------------------------------------------------
                      Totals
Total params           29601
Trainable params       29601
Non-trainable params       0
Mult-Adds              29200
================================================================================
n_classes=2
task=binary_cls
model_name=syn_featuresim_noise_0.1_2022-01-30-01-37-07
sche_threshold=0.0001
sche_patience=10
sche_factor=0.1
use_scheduler=False
num_workers=4
device=cuda:0
test_batch_size=4096
train_batch_size=32
learning_rate=0.001
weight_decay=0.0001
num_epochs=50
model_save_path=ckp/syn_featuresim_noise_0.1_2022-01-30-01-37-07.pth
test_rate=0.2
val_rate=0.1
multiprocess_context=fork
metrics=['accuracy']
metrics_f=[<metric.accuracy.Accuracy object at 0x7f893f821dc0>]
hidden_sizes=[100, 100]
model=SplitNN(
  (agg_model): MLP(
    (fc_layers): ModuleList(
      (0): Linear(in_features=100, out_features=100, bias=True)
      (1): Linear(in_features=100, out_features=1, bias=True)
    )
  )
  (local_models): ModuleList(
    (0): MLP(
      (fc_layers): ModuleList(
        (0): Linear(in_features=46, out_features=100, bias=True)
        (1): Linear(in_features=100, out_features=50, bias=True)
      )
    )
    (1): MLP(
      (fc_layers): ModuleList(
        (0): Linear(in_features=45, out_features=100, bias=True)
        (1): Linear(in_features=100, out_features=50, bias=True)
      )
    )
  )
)
writer=<torch.utils.tensorboard.writer.SummaryWriter object at 0x7f893f821e20>
dataset_type=syn
drop_key=True
num_common_features=5
tree_radius=2
tree_leaf_size=1000
knn_k=100
grid_min=-10.0
grid_max=10.0
grid_width=1.5
sim_scaler=StandardScaler()
filter_top_k=None
link_n_jobs=1
psig_p=7
sim_leak_p=1.0
link_threshold_t=0.1
link_epsilon=0.1
n_hash_lsh=20
edit_distance_threshold=1
n_hash_func=10
collision_rate=0.05
qgram_q=2
link_delta=0.1
feature_wise_sim=False
blocking_method=knn
center_threshold=0.5
n_clusters=100
local_hidden_sizes=[[100], [100]]
cut_dims=[50, 50]
agg_hidden_sizes=[100]
scale_analysis=None
data1_shape=(60000, 50)
data2_shape=(60000, 50)
Epoch 1: Loss:            : Train 0.6573, Val 0.6464, Test 0.6430
          Accuracy         : Train 0.5976, Val 0.6090, Test 0.6144
Best:
          Accuracy         : Train 0.5976, Val 0.6090, Test 0.6144
Epoch 2: Loss:            : Train 0.6366, Val 0.6424, Test 0.6393
          Accuracy         : Train 0.6258, Val 0.6132, Test 0.6188
Best:
          Accuracy         : Train 0.6258, Val 0.6132, Test 0.6188
Epoch 3: Loss:            : Train 0.6299, Val 0.6408, Test 0.6370
          Accuracy         : Train 0.6356, Val 0.6190, Test 0.6224
Best:
          Accuracy         : Train 0.6356, Val 0.6190, Test 0.6224
Epoch 4: Loss:            : Train 0.6256, Val 0.6408, Test 0.6362
          Accuracy         : Train 0.6408, Val 0.6184, Test 0.6236
Best:
          Accuracy         : Train 0.6356, Val 0.6190, Test 0.6224
Epoch 5: Loss:            : Train 0.6208, Val 0.6400, Test 0.6354
          Accuracy         : Train 0.6459, Val 0.6187, Test 0.6218
Best:
          Accuracy         : Train 0.6356, Val 0.6190, Test 0.6224
Epoch 6: Loss:            : Train 0.6160, Val 0.6426, Test 0.6378
          Accuracy         : Train 0.6510, Val 0.6181, Test 0.6241
Best:
          Accuracy         : Train 0.6356, Val 0.6190, Test 0.6224
Epoch 7: Loss:            : Train 0.6110, Val 0.6437, Test 0.6368
          Accuracy         : Train 0.6561, Val 0.6218, Test 0.6260
Best:
          Accuracy         : Train 0.6561, Val 0.6218, Test 0.6260
Epoch 8: Loss:            : Train 0.6059, Val 0.6387, Test 0.6310
          Accuracy         : Train 0.6629, Val 0.6258, Test 0.6321
Best:
          Accuracy         : Train 0.6629, Val 0.6258, Test 0.6321
Epoch 9: Loss:            : Train 0.6007, Val 0.6417, Test 0.6331
          Accuracy         : Train 0.6680, Val 0.6237, Test 0.6301
Best:
          Accuracy         : Train 0.6629, Val 0.6258, Test 0.6321
Epoch 10: Loss:            : Train 0.5963, Val 0.6459, Test 0.6373
          Accuracy         : Train 0.6698, Val 0.6205, Test 0.6302
Best:
          Accuracy         : Train 0.6629, Val 0.6258, Test 0.6321
Epoch 11: Loss:            : Train 0.5921, Val 0.6462, Test 0.6366
          Accuracy         : Train 0.6750, Val 0.6259, Test 0.6315
Best:
          Accuracy         : Train 0.6750, Val 0.6259, Test 0.6315
Epoch 12: Loss:            : Train 0.5879, Val 0.6438, Test 0.6347
          Accuracy         : Train 0.6778, Val 0.6260, Test 0.6346
Best:
          Accuracy         : Train 0.6778, Val 0.6260, Test 0.6346
Epoch 13: Loss:            : Train 0.5841, Val 0.6475, Test 0.6363
          Accuracy         : Train 0.6824, Val 0.6235, Test 0.6340
Best:
          Accuracy         : Train 0.6778, Val 0.6260, Test 0.6346
Epoch 14: Loss:            : Train 0.5803, Val 0.6529, Test 0.6425
          Accuracy         : Train 0.6856, Val 0.6213, Test 0.6334
Best:
          Accuracy         : Train 0.6778, Val 0.6260, Test 0.6346
Epoch 15: Loss:            : Train 0.5769, Val 0.6533, Test 0.6451
          Accuracy         : Train 0.6877, Val 0.6205, Test 0.6319
Best:
          Accuracy         : Train 0.6778, Val 0.6260, Test 0.6346
Epoch 16: Loss:            : Train 0.5727, Val 0.6511, Test 0.6419
          Accuracy         : Train 0.6912, Val 0.6230, Test 0.6310
Best:
          Accuracy         : Train 0.6778, Val 0.6260, Test 0.6346
Epoch 17: Loss:            : Train 0.5691, Val 0.6576, Test 0.6498
          Accuracy         : Train 0.6968, Val 0.6150, Test 0.6269
Best:
          Accuracy         : Train 0.6778, Val 0.6260, Test 0.6346
Epoch 18: Loss:            : Train 0.5655, Val 0.6555, Test 0.6473
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 19: Loss:            : Train 0.5622, Val 0.6639, Test 0.6545
          Accuracy         : Train 0.7010, Val 0.6184, Test 0.6315
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 20: Loss:            : Train 0.5590, Val 0.6682, Test 0.6544
          Accuracy         : Train 0.7047, Val 0.6227, Test 0.6346
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 21: Loss:            : Train 0.5561, Val 0.6671, Test 0.6551
          Accuracy         : Train 0.7059, Val 0.6183, Test 0.6295
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 22: Loss:            : Train 0.5542, Val 0.6634, Test 0.6572
          Accuracy         : Train 0.7072, Val 0.6179, Test 0.6299
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 23: Loss:            : Train 0.5499, Val 0.6723, Test 0.6655
          Accuracy         : Train 0.7114, Val 0.6178, Test 0.6314
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 24: Loss:            : Train 0.5467, Val 0.6658, Test 0.6592
          Accuracy         : Train 0.7151, Val 0.6186, Test 0.6281
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 25: Loss:            : Train 0.5434, Val 0.6755, Test 0.6671
          Accuracy         : Train 0.7161, Val 0.6182, Test 0.6253
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 26: Loss:            : Train 0.5411, Val 0.6807, Test 0.6739
          Accuracy         : Train 0.7178, Val 0.6180, Test 0.6247
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 27: Loss:            : Train 0.5387, Val 0.6825, Test 0.6722
          Accuracy         : Train 0.7204, Val 0.6142, Test 0.6227
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 28: Loss:            : Train 0.5353, Val 0.6901, Test 0.6802
          Accuracy         : Train 0.7221, Val 0.6156, Test 0.6260
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 29: Loss:            : Train 0.5321, Val 0.6914, Test 0.6813
          Accuracy         : Train 0.7245, Val 0.6121, Test 0.6186
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 30: Loss:            : Train 0.5283, Val 0.7020, Test 0.6866
          Accuracy         : Train 0.7290, Val 0.6140, Test 0.6224
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 31: Loss:            : Train 0.5275, Val 0.7020, Test 0.6896
          Accuracy         : Train 0.7281, Val 0.6091, Test 0.6204
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 32: Loss:            : Train 0.5244, Val 0.6959, Test 0.6858
          Accuracy         : Train 0.7321, Val 0.6145, Test 0.6213
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 33: Loss:            : Train 0.5209, Val 0.7051, Test 0.6904
          Accuracy         : Train 0.7342, Val 0.6129, Test 0.6198
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 34: Loss:            : Train 0.5171, Val 0.7178, Test 0.7009
          Accuracy         : Train 0.7364, Val 0.6103, Test 0.6184
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 35: Loss:            : Train 0.5149, Val 0.7144, Test 0.7006
          Accuracy         : Train 0.7369, Val 0.6053, Test 0.6156
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 36: Loss:            : Train 0.5129, Val 0.7296, Test 0.7159
          Accuracy         : Train 0.7394, Val 0.6102, Test 0.6186
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 37: Loss:            : Train 0.5098, Val 0.7213, Test 0.7008
          Accuracy         : Train 0.7420, Val 0.6064, Test 0.6185
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 38: Loss:            : Train 0.5060, Val 0.7278, Test 0.7070
          Accuracy         : Train 0.7462, Val 0.6077, Test 0.6174
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 39: Loss:            : Train 0.5039, Val 0.7418, Test 0.7212
          Accuracy         : Train 0.7462, Val 0.6012, Test 0.6122
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 40: Loss:            : Train 0.5001, Val 0.7453, Test 0.7284
          Accuracy         : Train 0.7489, Val 0.6038, Test 0.6167
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 41: Loss:            : Train 0.4984, Val 0.7618, Test 0.7419
          Accuracy         : Train 0.7494, Val 0.6044, Test 0.6187
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 42: Loss:            : Train 0.4950, Val 0.7704, Test 0.7459
          Accuracy         : Train 0.7519, Val 0.6016, Test 0.6079
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 43: Loss:            : Train 0.4925, Val 0.7605, Test 0.7358
          Accuracy         : Train 0.7546, Val 0.6012, Test 0.6123
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 44: Loss:            : Train 0.4899, Val 0.7705, Test 0.7491
          Accuracy         : Train 0.7556, Val 0.6050, Test 0.6126
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 45: Loss:            : Train 0.4880, Val 0.7686, Test 0.7452
          Accuracy         : Train 0.7566, Val 0.5982, Test 0.6075
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 46: Loss:            : Train 0.4836, Val 0.7999, Test 0.7733
          Accuracy         : Train 0.7601, Val 0.6012, Test 0.6131
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 47: Loss:            : Train 0.4799, Val 0.8131, Test 0.7829
          Accuracy         : Train 0.7616, Val 0.5861, Test 0.5999
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 48: Loss:            : Train 0.4775, Val 0.7903, Test 0.7703
          Accuracy         : Train 0.7643, Val 0.5972, Test 0.6020
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 49: Loss:            : Train 0.4742, Val 0.8139, Test 0.7909
          Accuracy         : Train 0.7670, Val 0.5956, Test 0.6055
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Epoch 50: Loss:            : Train 0.4708, Val 0.8148, Test 0.7902
          Accuracy         : Train 0.7683, Val 0.6041, Test 0.6129
Best:
          Accuracy         : Train 0.6979, Val 0.6270, Test 0.6342
Training time (sec): 1712
