Loading data from cache
Done
Calculating noise scale
Adding noise of scale 0.0 to sim_scores
Adding noise of scale 0.0 to sim_scores
Adding noise of scale 0.0 to sim_scores
Filter dataset to top 40
Generating top 40 dataset
Generating top 40 dataset
Generating top 40 dataset
Preparing time (sec): 33
Initializing dataloader
Done
Prepare for training
Start training
SplitNN summary
==========================================================================================
Layer (type:depth-idx)                   Output Shape              Param #
==========================================================================================
SplitNN                                  --                        --
├─MLP: 1                                 --                        --
│    └─ModuleList: 2-1                   --                        --
├─ModuleList: 1-1                        --                        --
│    └─MLP: 2                            --                        --
│    │    └─ModuleList: 3-1              --                        9,650
│    └─MLP: 2                            --                        --
│    │    └─ModuleList: 3-2              --                        9,650
│    └─MLP: 2-2                          [32, 50]                  --
│    └─MLP: 2-3                          [32, 50]                  --
├─MLP: 1-2                               [32, 1]                   --
│    └─ModuleList: 2-1                   --                        --
│    │    └─Linear: 3-3                  [32, 100]                 10,100
│    │    └─Linear: 3-4                  [32, 1]                   101
==========================================================================================
Total params: 29,501
Trainable params: 29,501
Non-trainable params: 0
Total mult-adds (M): 0.94
==========================================================================================
Input size (MB): 0.01
Forward/backward pass size (MB): 0.10
Params size (MB): 0.12
Estimated Total Size (MB): 0.23
==========================================================================================
Similarity model summary
==========================================================================================
Layer (type:depth-idx)                   Output Shape              Param #
==========================================================================================
MLP                                      --                        --
├─ModuleList: 1-1                        --                        --
│    └─Linear: 2-1                       [1, 10]                   20
│    └─Linear: 2-2                       [1, 1]                    11
==========================================================================================
Total params: 31
Trainable params: 31
Non-trainable params: 0
Total mult-adds (M): 0.00
==========================================================================================
Input size (MB): 0.00
Forward/backward pass size (MB): 0.00
Params size (MB): 0.00
Estimated Total Size (MB): 0.00
==========================================================================================
n_classes=2
task=binary_cls
model_name=syn_fedsim_noise_0.2_2022-01-27-11-33-06
sche_threshold=0.0001
sche_patience=10
sche_factor=0.1
use_scheduler=False
num_workers=4
device=cuda:2
test_batch_size=4096
train_batch_size=32
learning_rate=0.001
weight_decay=0.0001
num_epochs=50
model_save_path=ckp/syn_fedsim_noise_0.2_2022-01-27-11-33-06.pth
test_rate=0.2
val_rate=0.1
multiprocess_context=fork
metrics=['accuracy']
metrics_f=[<metric.accuracy.Accuracy object at 0x7ffac8c3fb20>]
hidden_sizes=[100, 100]
model=SplitNN(
  (agg_model): MLP(
    (fc_layers): ModuleList(
      (0): Linear(in_features=100, out_features=100, bias=True)
      (1): Linear(in_features=100, out_features=1, bias=True)
    )
  )
  (local_models): ModuleList(
    (0): MLP(
      (fc_layers): ModuleList(
        (0): Linear(in_features=45, out_features=100, bias=True)
        (1): Linear(in_features=100, out_features=50, bias=True)
      )
    )
    (1): MLP(
      (fc_layers): ModuleList(
        (0): Linear(in_features=45, out_features=100, bias=True)
        (1): Linear(in_features=100, out_features=50, bias=True)
      )
    )
  )
)
writer=<torch.utils.tensorboard.writer.SummaryWriter object at 0x7ffac8c3fb50>
dataset_type=syn
drop_key=True
num_common_features=5
tree_radius=2
tree_leaf_size=1000
knn_k=40
grid_min=-10.0
grid_max=10.0
grid_width=1.5
sim_scaler=StandardScaler()
filter_top_k=40
link_n_jobs=1
psig_p=7
sim_leak_p=1.0
link_threshold_t=0.1
link_epsilon=0.1
n_hash_lsh=20
edit_distance_threshold=1
n_hash_func=10
collision_rate=0.05
qgram_q=2
link_delta=0.1
feature_wise_sim=False
blocking_method=knn
center_threshold=0.5
n_clusters=100
local_hidden_sizes=[[100], [100]]
cut_dims=[50, 50]
agg_hidden_sizes=[100]
scale_analysis=None
mlp_merge=None
use_sim=True
use_conv=False
conv_kernel_v_size=7
conv_n_channels=4
merge_dropout_p=0.8
raw_output_dim=1
log_dir=log/syn_fedsim_noise_0.2_2022-01-27-11-33-06/
update_sim_freq=1
sim_model_save_path=ckp/syn_fedsim_noise_0.2_2022-01-27-11-33-06_sim.pth
merge_model_save_path=ckp/syn_fedsim_noise_0.2_2022-01-27-11-33-06_merge.pth
sim_batch_size=128
sim_weight_decay=0.0001
sim_learning_rate=0.001
merge_model=AvgSumModel()
sim_model=MLP(
  (fc_layers): ModuleList(
    (0): Linear(in_features=1, out_features=10, bias=True)
    (1): Linear(in_features=10, out_features=1, bias=True)
  )
)
sim_hidden_sizes=[10]
merge_hidden_sizes=[400]
data1_shape=(60000, 50)
data2_shape=(60000, 50)
Epoch 1: Loss:            : Train 0.6578, Val 0.6389, Test 0.6347
          Accuracy         : Train 0.5939, Val 0.6180, Test 0.6282
Best:
          Accuracy         : Train 0.5939, Val 0.6180, Test 0.6282
Epoch 2: Loss:            : Train 0.5962, Val 0.5734, Test 0.5612
          Accuracy         : Train 0.6717, Val 0.6905, Test 0.7019
Best:
          Accuracy         : Train 0.6717, Val 0.6905, Test 0.7019
Epoch 3: Loss:            : Train 0.5614, Val 0.5637, Test 0.5480
          Accuracy         : Train 0.7043, Val 0.6947, Test 0.7117
Best:
          Accuracy         : Train 0.7043, Val 0.6947, Test 0.7117
Epoch 4: Loss:            : Train 0.5473, Val 0.5517, Test 0.5374
          Accuracy         : Train 0.7169, Val 0.7122, Test 0.7187
Best:
          Accuracy         : Train 0.7169, Val 0.7122, Test 0.7187
Epoch 5: Loss:            : Train 0.5366, Val 0.5468, Test 0.5350
          Accuracy         : Train 0.7221, Val 0.7143, Test 0.7226
Best:
          Accuracy         : Train 0.7221, Val 0.7143, Test 0.7226
Epoch 6: Loss:            : Train 0.5273, Val 0.5682, Test 0.5536
          Accuracy         : Train 0.7322, Val 0.6960, Test 0.7111
Best:
          Accuracy         : Train 0.7221, Val 0.7143, Test 0.7226
Epoch 7: Loss:            : Train 0.5198, Val 0.5462, Test 0.5324
          Accuracy         : Train 0.7371, Val 0.7143, Test 0.7223
Best:
          Accuracy         : Train 0.7221, Val 0.7143, Test 0.7226
Epoch 8: Loss:            : Train 0.5116, Val 0.5454, Test 0.5332
          Accuracy         : Train 0.7440, Val 0.7145, Test 0.7258
Best:
          Accuracy         : Train 0.7440, Val 0.7145, Test 0.7258
Epoch 9: Loss:            : Train 0.5038, Val 0.5419, Test 0.5289
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 10: Loss:            : Train 0.4967, Val 0.5606, Test 0.5447
          Accuracy         : Train 0.7528, Val 0.7058, Test 0.7237
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 11: Loss:            : Train 0.4885, Val 0.5452, Test 0.5330
          Accuracy         : Train 0.7585, Val 0.7187, Test 0.7266
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 12: Loss:            : Train 0.4821, Val 0.5537, Test 0.5389
          Accuracy         : Train 0.7617, Val 0.7117, Test 0.7277
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 13: Loss:            : Train 0.4755, Val 0.5538, Test 0.5460
          Accuracy         : Train 0.7678, Val 0.7145, Test 0.7208
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 14: Loss:            : Train 0.4690, Val 0.5526, Test 0.5463
          Accuracy         : Train 0.7699, Val 0.7177, Test 0.7258
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 15: Loss:            : Train 0.4633, Val 0.5654, Test 0.5591
          Accuracy         : Train 0.7757, Val 0.7118, Test 0.7170
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 16: Loss:            : Train 0.4579, Val 0.5648, Test 0.5572
          Accuracy         : Train 0.7793, Val 0.7117, Test 0.7238
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 17: Loss:            : Train 0.4526, Val 0.5734, Test 0.5712
          Accuracy         : Train 0.7815, Val 0.7120, Test 0.7196
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 18: Loss:            : Train 0.4464, Val 0.5702, Test 0.5718
          Accuracy         : Train 0.7842, Val 0.7118, Test 0.7126
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 19: Loss:            : Train 0.4422, Val 0.5822, Test 0.5836
          Accuracy         : Train 0.7867, Val 0.7185, Test 0.7177
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 20: Loss:            : Train 0.4363, Val 0.5978, Test 0.5965
          Accuracy         : Train 0.7887, Val 0.7117, Test 0.7107
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 21: Loss:            : Train 0.4318, Val 0.6002, Test 0.6024
          Accuracy         : Train 0.7913, Val 0.7062, Test 0.7095
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 22: Loss:            : Train 0.4280, Val 0.5946, Test 0.5922
          Accuracy         : Train 0.7931, Val 0.7033, Test 0.7093
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 23: Loss:            : Train 0.4223, Val 0.6073, Test 0.6039
          Accuracy         : Train 0.7965, Val 0.7067, Test 0.7123
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 24: Loss:            : Train 0.4177, Val 0.6197, Test 0.6331
          Accuracy         : Train 0.7974, Val 0.7060, Test 0.7107
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 25: Loss:            : Train 0.4148, Val 0.6075, Test 0.6116
          Accuracy         : Train 0.8003, Val 0.7075, Test 0.7133
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 26: Loss:            : Train 0.4118, Val 0.6114, Test 0.6145
          Accuracy         : Train 0.8014, Val 0.6988, Test 0.7074
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 27: Loss:            : Train 0.4074, Val 0.6167, Test 0.6292
          Accuracy         : Train 0.8039, Val 0.7035, Test 0.7097
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 28: Loss:            : Train 0.4044, Val 0.6302, Test 0.6408
          Accuracy         : Train 0.8080, Val 0.6988, Test 0.7038
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 29: Loss:            : Train 0.4011, Val 0.6367, Test 0.6405
          Accuracy         : Train 0.8078, Val 0.7063, Test 0.7068
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 30: Loss:            : Train 0.3980, Val 0.6276, Test 0.6432
          Accuracy         : Train 0.8095, Val 0.7062, Test 0.7097
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 31: Loss:            : Train 0.3952, Val 0.6281, Test 0.6409
          Accuracy         : Train 0.8112, Val 0.7080, Test 0.7080
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 32: Loss:            : Train 0.3930, Val 0.6432, Test 0.6652
          Accuracy         : Train 0.8125, Val 0.7037, Test 0.7089
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 33: Loss:            : Train 0.3908, Val 0.6651, Test 0.6764
          Accuracy         : Train 0.8147, Val 0.7025, Test 0.7087
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 34: Loss:            : Train 0.3879, Val 0.6531, Test 0.6694
          Accuracy         : Train 0.8166, Val 0.7067, Test 0.7142
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 35: Loss:            : Train 0.3881, Val 0.6565, Test 0.6981
          Accuracy         : Train 0.8154, Val 0.7005, Test 0.7034
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 36: Loss:            : Train 0.3857, Val 0.6600, Test 0.6701
          Accuracy         : Train 0.8176, Val 0.7008, Test 0.7071
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 37: Loss:            : Train 0.3831, Val 0.6598, Test 0.6934
          Accuracy         : Train 0.8199, Val 0.7000, Test 0.7016
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 38: Loss:            : Train 0.3811, Val 0.6635, Test 0.6753
          Accuracy         : Train 0.8208, Val 0.6983, Test 0.7033
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 39: Loss:            : Train 0.3813, Val 0.6584, Test 0.6749
          Accuracy         : Train 0.8204, Val 0.6998, Test 0.7083
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 40: Loss:            : Train 0.3807, Val 0.6631, Test 0.6908
          Accuracy         : Train 0.8206, Val 0.6995, Test 0.7075
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 41: Loss:            : Train 0.3758, Val 0.6678, Test 0.6930
          Accuracy         : Train 0.8234, Val 0.6970, Test 0.7062
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 42: Loss:            : Train 0.3743, Val 0.6729, Test 0.7123
          Accuracy         : Train 0.8242, Val 0.6998, Test 0.7006
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 43: Loss:            : Train 0.3722, Val 0.6907, Test 0.7345
          Accuracy         : Train 0.8236, Val 0.7023, Test 0.7060
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 44: Loss:            : Train 0.3732, Val 0.6824, Test 0.7095
          Accuracy         : Train 0.8244, Val 0.7005, Test 0.7053
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 45: Loss:            : Train 0.3683, Val 0.6937, Test 0.7292
          Accuracy         : Train 0.8249, Val 0.6905, Test 0.6996
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 46: Loss:            : Train 0.3666, Val 0.6906, Test 0.7196
          Accuracy         : Train 0.8286, Val 0.6938, Test 0.7001
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 47: Loss:            : Train 0.3645, Val 0.6922, Test 0.7153
          Accuracy         : Train 0.8282, Val 0.6975, Test 0.7064
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 48: Loss:            : Train 0.3649, Val 0.6931, Test 0.7260
          Accuracy         : Train 0.8291, Val 0.6975, Test 0.7015
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 49: Loss:            : Train 0.3648, Val 0.6860, Test 0.7323
          Accuracy         : Train 0.8307, Val 0.7000, Test 0.7043
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Epoch 50: Loss:            : Train 0.3636, Val 0.6877, Test 0.7131
          Accuracy         : Train 0.8307, Val 0.6968, Test 0.7047
Best:
          Accuracy         : Train 0.7488, Val 0.7208, Test 0.7284
Training time (sec): 3204
